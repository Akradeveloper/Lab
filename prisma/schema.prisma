// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

enum Role {
  ALUMNO
  ADMIN
}

model User {
  id                   String                @id @default(cuid())
  email                String                @unique
  passwordHash         String
  name                 String
  role                 Role                  @default(ALUMNO)
  createdAt            DateTime              @default(now())
  progress             Progress[]
  lessonCheckAttempts  LessonCheckAttempt[]
  exerciseAttempts     ExerciseAttempt[]
}

model Progress {
  id          String   @id @default(cuid())
  userId      String
  courseId    String
  lessonId    String
  completedAt DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum ExerciseType {
  MULTIPLE_CHOICE
  TRUE_FALSE
  CODE
}

enum DifficultyLevel {
  APRENDIZ
  JUNIOR
  MID
  SENIOR
  ESPECIALISTA
}

model Module {
  id          String      @id @default(cuid())
  title       String
  description String?
  order       Int         @default(0)
  createdAt   DateTime    @default(now())
  submodules  Submodule[]
  lessons     Lesson[]
}

model Submodule {
  id          String   @id @default(cuid())
  moduleId    String
  title       String
  description String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  module      Module   @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  lessons     Lesson[]
}

model Lesson {
  id           String          @id @default(cuid())
  moduleId     String?
  submoduleId  String?
  title        String
  content      String          @default("")
  order        Int             @default(0)
  difficulty   DifficultyLevel?
  createdAt    DateTime        @default(now())
  module       Module?         @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  submodule    Submodule?      @relation(fields: [submoduleId], references: [id], onDelete: Cascade)
  exercises    Exercise[]
}

model Exercise {
  id              String            @id @default(cuid())
  lessonId        String
  type            ExerciseType
  question        String
  options         String            // JSON: MULTIPLE_CHOICE/TRUE_FALSE = array of options; CODE = { language, template, testCases }
  correctAnswer   String            // JSON: MULTIPLE_CHOICE = index (number), TRUE_FALSE = boolean, CODE = "" or reserved
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  lesson          Lesson            @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  exerciseAttempts ExerciseAttempt[]
}

model LessonCheckAttempt {
  id          String   @id @default(cuid())
  userId      String
  lessonId    String
  allCorrect  Boolean
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ExerciseAttempt {
  id         String   @id @default(cuid())
  userId     String
  exerciseId String
  lessonId   String
  correct    Boolean
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
}
